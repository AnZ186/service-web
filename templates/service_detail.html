{% extends 'base.html' %}
{% load humanize %}

{% block content %}
<div class="container py-5">
    
    <div class="row g-5 align-items-center mb-5">
        <div class="col-lg-6" data-aos="fade-right" data-aos-duration="1000">
            <div class="position-relative rounded-4 overflow-hidden shadow-2xl group">
                <div class="ratio ratio-4x3">
                    {% if service.image %}
                    <img src="{{ service.image.url }}" class="object-fit-cover transition-scale" alt="{{ service.title }}">
                    {% else %}
                    <div class="bg-dark d-flex align-items-center justify-content-center">
                        <i class="bi bi-grid-fill display-1 text-secondary opacity-25"></i>
                    </div>
                    {% endif %}
                </div>
                <div class="position-absolute inset-0 bg-gradient-to-t from-black to-transparent opacity-50"></div>
                
                <span class="badge bg-primary position-absolute top-0 start-0 m-4 fs-6 shadow-lg animate-bounce-slow">
                    {{ service.get_category_display }}
                </span>
            </div>
        </div>

        <div class="col-lg-6" data-aos="fade-left" data-aos-duration="1000" data-aos-delay="200">
            <h1 class="display-4 fw-bold text-white mb-3 text-glow">{{ service.title }}</h1>
            <h3 class="text-primary fw-bold mb-4 animate-pulse">Rp {{ service.price|intcomma }}</h3>
            <p class="lead text-secondary mb-5">{{ service.description }}</p>
            
            <div class="d-flex gap-3">
                <a href="https://wa.me/{{ global_settings.whatsapp_number }}?text=Halo%20Admin,%20saya%20tertarik%20dengan%20jasa%20{{ service.title }}" 
                   target="_blank" 
                   class="btn btn-gradient rounded-pill px-5 py-3 fw-bold shadow-glow hover-scale">
                    <i class="bi bi-whatsapp me-2"></i>Pesanan Sekarang
                </a>
            </div>
        </div>
    </div>

    {% if related_services %}
    <div class="mb-5 py-4 border-top border-bottom border-secondary border-opacity-25" data-aos="fade-up">
        <h5 class="text-white fw-bold mb-4"><i class="bi bi-stars text-warning me-2"></i>Jasa Sejenis</h5>
        <div class="row g-3">
            {% for rel in related_services %}
            <div class="col-md-4">
                <a href="{% url 'service_detail' rel.pk %}" class="text-decoration-none">
                    <div class="glass-card p-3 hover-card d-flex align-items-center gap-3">
                        <div class="rounded-3 overflow-hidden" style="width: 60px; height: 60px;">
                            {% if rel.image %}<img src="{{ rel.image.url }}" class="w-100 h-100 object-fit-cover">{% endif %}
                        </div>
                        <div>
                            <h6 class="text-white mb-1 small fw-bold">{{ rel.title }}</h6>
                            <small class="text-primary">Rp {{ rel.price|intcomma }}</small>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class="row justify-content-center" data-aos="fade-up" data-aos-offset="100">
        <div class="col-lg-8">
            <div class="glass-card p-4 p-md-5">
                <h3 class="fw-bold text-white mb-4 border-bottom border-secondary border-opacity-25 pb-3">
                    Ulasan Pelanggan <span class="badge bg-dark border border-secondary border-opacity-25 rounded-pill fs-6 align-middle ms-2">{{ reviews.count }}</span>
                </h3>

                <div class="review-list mb-5">
                    {% for review in reviews %}
                    <div class="d-flex gap-3 mb-4 animate-review-item" style="animation-delay: {{ forloop.counter0|add:'1' }}00ms;">
                        <div class="flex-shrink-0">
                            <div class="rounded-circle bg-gradient-secondary d-flex align-items-center justify-content-center text-white fw-bold shadow-sm" style="width: 50px; height: 50px;">
                                {{ review.user_name|slice:":1"|upper }}
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <div class="glass-card p-3 rounded-4 rounded-top-0 border-0 bg-white bg-opacity-5">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <h6 class="fw-bold text-white mb-0">{{ review.user_name }}</h6>
                                    <div class="text-warning small">
                                        {% for i in "12345" %}
                                            <i class="bi bi-star{% if forloop.counter <= review.rating %}-fill{% endif %}"></i>
                                        {% endfor %}
                                    </div>
                                </div>
                                <p class="text-secondary small mb-0">{{ review.comment }}</p>
                            </div>
                            <small class="text-muted ms-2" style="font-size: 0.75rem;">{{ review.created_at|timesince }} yang lalu</small>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center py-4 opacity-50">
                        <i class="bi bi-chat-square-text fs-1"></i>
                        <p>Belum ada ulasan. Jadilah yang pertama!</p>
                    </div>
                    {% endfor %}
                </div>

                <h5 class="text-white fw-bold mb-3">Tulis Ulasan</h5>
                <form method="POST" class="animate-fade-in delay-3">
                    {% csrf_token %}
                    <div class="row g-3">
                        <div class="col-md-8">
                            <input type="text" name="user_name" class="form-control glass-input" placeholder="Nama Anda" required>
                        </div>
                        <div class="col-md-4">
                            <select name="rating" class="form-select glass-input text-warning fw-bold" required>
                                <option value="5">⭐⭐⭐⭐⭐ (5)</option>
                                <option value="4">⭐⭐⭐⭐ (4)</option>
                                <option value="3">⭐⭐⭐ (3)</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <textarea name="comment" rows="3" class="form-control glass-input" placeholder="Ceritakan pengalaman Anda..." required></textarea>
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-outline-light rounded-pill px-4 hover-white">Kirim Ulasan</button>
                        </div>
                    </div>
                </form>

            </div>
        </div>
    </div>
</div>

<style>
    /* Hero Image Scale */
    .transition-scale { transition: transform 0.6s ease; width: 100%; height: 100%; }
    .group:hover .transition-scale { transform: scale(1.05); }
    
    /* Text Glow */
    .text-glow { text-shadow: 0 0 20px rgba(59, 130, 246, 0.4); }
    
    /* Inputs */
    .glass-input {
        background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); color: white; border-radius: 12px;
    }
    .glass-input:focus {
        background: rgba(0,0,0,0.5); border-color: #3b82f6; color: white;
    }
    .hover-white:hover { background: white; color: black; border-color: white; }

    /* Review Animation */
    .animate-review-item { 
        animation: slideInUp 0.5s ease-out forwards; 
        opacity: 0; 
        transform: translateY(20px);
    }
    @keyframes slideInUp { to { opacity: 1; transform: translateY(0); } }
    
    .shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
</style>
{% endblock %}
